\input ifinput.tex
\ifinput luatexja.sty;
\begingroup\endlinechar=-1
% lfont* means this will not distinguish font and jfont
%
\expandafter\newtoks\csname[rikuri latin or not]\endcsname
\expandafter\newtoks\csname [rikuri fam]\endcsname
\expandafter\newtoks\csname[rikuri jfam]\endcsname
\expandafter\newtoks\csname [rikuri lfont csname]\endcsname
\expandafter\newtoks\csname [rikuri cachetoks]\endcsname
\expandafter\newtoks\csname[rikuri lfontcommand]\endcsname
\expandafter\newtoks\csname[rikuri famset command]\endcsname
%
\expandafter\newtoks\csname [rikuri^font]\endcsname\global\csname [rikuri^font]\endcsname={}
\expandafter\newtoks\csname[rikuri^jfont]\endcsname\global\csname[rikuri^jfont]\endcsname={}
\expandafter\newtoks\csname [rikuri^fontname]\endcsname
\expandafter\newtoks\csname[rikuri^jfontname]\endcsname
\expandafter\newtoks\csname [rikuri^fontsize]\endcsname\global\csname [rikuri^fontsize]\endcsname={scaled 1000}
\expandafter\newtoks\csname[rikuri^jfontsize]\endcsname\global\csname[rikuri^jfontsize]\endcsname={scaled 1000}
\expandafter\newtoks\csname [rikuri^textfont]\endcsname
\expandafter\newtoks\csname [rikuri^scriptfont]\endcsname
\expandafter\newtoks\csname [rikuri^scriptscriptfont]\endcsname
\expandafter\newtoks\csname[rikuri^jtextfont]\endcsname
\expandafter\newtoks\csname[rikuri^jscriptfont]\endcsname
\expandafter\newtoks\csname[rikuri^jscriptscriptfont]\endcsname

\gdef\lLfont#1=#2{\lfont{#1}={#2}\relax\Lfont{#1}={#2}\relax}
\gdef\lfont#1=#2{
\csname[rikuri latin or not]\endcsname={}
\csname[rikuri font with latin or not]\endcsname{#1}={#2}
}
\gdef\Lfont#1=#2{
\csname[rikuri latin or not]\endcsname={j}
\csname[rikuri font with latin or not]\endcsname{#1}={#2}
}
%\expandafter\gdef\csname[rikuri font with latin or not]\endcsname#1{
%\csname[rikuri fam]\endcsname={}
%\csname[rikuri jfam]\endcsname={}
%\csname[rikuri cachetoks]\endcsname={}
%\csname[rikuri lfontcommand]\endcsname={}
%\csname[rikuri famset command]\endcsname={}
%\csname[rikuri latin or not]\endcsname={#1}
%\csname[rikuri font]\endcsname
%}
%\expandafter\gdef\csname[rikuri font]\endcsname{
%\expandafter\futurelet
%\csname[rikuri after{font}]\expandafter\endcsname
%\csname[rikuri{font}]\endcsname
%}
%\expandafter\gdef\csname[rikuri{font}]\endcsname{
%\csname[rikuri check not digit]\endcsname
%{\csname[rikuri after{font}]\endcsname}
%{\csname[rikuri not digit while relax]\endcsname}
%%
%\expandafter\ifx\csname[rikuri not digit while relax]\endcsname\relax
%\expandafter\let
%\csname[rikuri{font}next]\expandafter\endcsname
%\csname[rikuri font with fam]\endcsname
%\else
%\expandafter\let
%\csname[rikuri{font}next]\expandafter\endcsname
%\csname[rikuri font with number]\endcsname
%\fi
%\csname[rikuri{font}next]\endcsname
%}
%\expandafter\gdef\csname[rikuri font with number]\endcsname#1{
%\csname[rikuri \the\csname[rikuri latin or not]\endcsname fam]\endcsname=\expandafter{
%\the\csname[rikuri \the\csname[rikuri latin or not]\endcsname fam]\endcsname#1
%}
%\csname[rikuri font]\endcsname
%}
\expandafter\gdef\csname[rikuri font with latin or not]\endcsname#1=#2{
\csname[rikuri cachetoks]\endcsname={}
\csname[rikuri lfont csname]\endcsname={}
\csname[rikuri lfontcommand]\endcsname={}
\let\rikuriendcsname\endcsname
\let\endcsname\relax
%
\expandafter\edef\csname[rikuri lfont notcsname]\rikuriendcsname{
\ifx\csname#1\else\csname[rikuri notcsname]\expandafter\rikuriendcsname\string#1\fi
}
\let\endcsname\rikuriendcsname
% Use \csname[rikuri lfont csname]\endcsname but not #1 to later
% to make the same behavior
% no mater #1 was anyone of: \ft, \csname ft\endcsname
%
\csname[rikuri lfont csname]\endcsname=\expandafter\expandafter\expandafter{
\csname[rikuri lfont notcsname]\endcsname
}
\csname[rikuri lfontcommand]\endcsname=\expandafter{
\expandafter\the
\csname[rikuri^\the\csname[rikuri latin or not]\endcsname fontsize]\expandafter\endcsname
\the\csname[rikuri lfontcommand]\endcsname
}
\csname[rikuri cachetoks]\endcsname={#2}
\csname[rikuri lfontcommand]\endcsname=\expandafter{\expandafter=
\the\csname[rikuri cachetoks]\expandafter\expandafter\expandafter\endcsname
\expandafter\space
\the\csname[rikuri lfontcommand]\endcsname
}
\csname[rikuri cachetoks]\endcsname=\expandafter{
% if the csname is \ft, this will be \[rikuri font ft] or \[rikuri jfont ft]
% the true csname to \font or \jfont is here
\csname[rikuri \the\csname[rikuri latin or not]\endcsname font \the\csname[rikuri lfont csname]\endcsname\expandafter]\endcsname
}
\csname[rikuri lfontcommand]\endcsname=\expandafter{
\the\csname[rikuri cachetoks]\expandafter\endcsname
\the\csname[rikuri lfontcommand]\endcsname
}
\csname[rikuri lfontcommand]\endcsname=\expandafter{
\csname\the\csname[rikuri latin or not]\endcsname font\expandafter\endcsname%\jfont or \font
\the\csname[rikuri lfontcommand]\endcsname
}
\csname[rikuri lfontcommand]\endcsname=\expandafter{
\the\csname[rikuri lfontcommand]\expandafter\endcsname
\expandafter\relax
\the\csname[rikuri cachetoks]\endcsname
}
\csname[rikuri cachetoks]\endcsname=\expandafter{
\csname[rikuri^\the\csname[rikuri latin or not]\endcsname font]\expandafter\endcsname\expandafter=\expandafter{
\the\csname[rikuri lfont csname]\endcsname
}
}
\csname[rikuri lfontcommand]\endcsname=\expandafter{
\the\csname[rikuri lfontcommand]\expandafter\endcsname
\expandafter\relax
\the\csname[rikuri cachetoks]\endcsname
}
\expandafter\ifx
\csname[rikuri fontcommand \the\csname[rikuri lfont csname]\endcsname]\endcsname
\relax
\csname newtoks\expandafter\endcsname
\csname[rikuri fontcommand \the\csname[rikuri lfont csname]\endcsname]\endcsname
\fi
\expandafter\ifx
\csname[rikuri jfontcommand \the\csname[rikuri lfont csname]\endcsname]\endcsname
\relax
\csname newtoks\expandafter\endcsname
\csname[rikuri jfontcommand \the\csname[rikuri lfont csname]\endcsname]\endcsname
\fi
\csname[
rikuri \the\csname[rikuri latin or not]\endcsname
fontcommand \the\csname[rikuri lfont csname]\endcsname
]\endcsname=\expandafter{\the\csname[rikuri lfontcommand]\endcsname}
\expandafter\edef\csname\the\csname[rikuri lfont csname]\endcsname\endcsname{
\the\csname [rikuri fontcommand \the\csname[rikuri lfont csname]\endcsname]\endcsname
\the\csname[rikuri jfontcommand \the\csname[rikuri lfont csname]\endcsname]\endcsname
}
\expandafter\def\csname
\the\csname[rikuri lfont csname]\endcsname\expandafter\expandafter\expandafter
\endcsname\expandafter\expandafter\expandafter{
\csname\the\csname[rikuri lfont csname]\endcsname\endcsname
\the\csname [rikuri^textfont]\endcsname
\the\csname [rikuri^scriptfont]\endcsname
\the\csname [rikuri^scriptscriptfont]\endcsname
\the\csname[rikuri^jtextfont]\endcsname
\the\csname[rikuri^jscriptfont]\endcsname
\the\csname[rikuri^jscriptscriptfont]\endcsname
%TODO: set math font here
}
}
\gdef\ltextfont{\csname[rikuri mathfont]\endcsname\textfont}
\gdef\lscriptfont{\csname[rikuri mathfont]\endcsname\scriptfont}
\gdef\lscriptscriptfont{\csname[rikuri mathfont]\endcsname\scriptscriptfont}
\expandafter\gdef\csname[rikuri mathfont]\endcsname#1{
\expandafter\let\csname[rikuri mathfont type]\endcsname#1
\expandafter\afterassignment\csname[rikuri mathfont with type]\endcsname
\count0=
}
\expandafter\gdef\csname[rikuri mathfont with type]\endcsname=#1{
\expandafter\edef\csname[rikuri lfont notcsname]\rikuriendcsname{
\ifx\csname#1\else\csname[rikuri notcsname]\expandafter\rikuriendcsname\string#1\fi
}
\let\endcsname\rikuriendcsname
\csname[rikuri mathfont type]\endcsname\count0=\the\csname[rikuri font \csname[rikuri lfont notcsname]\endcsname]\endcsname
}
\gdef\Ltextfont{\csname[rikuri jamathfont]\endcsname{jatextfont}}
\gdef\Lscriptfont{\csname[rikuri jamathfont]\endcsname{jascriptfont}}
\gdef\Lscriptscriptfont{\csname[rikuri jamathfont]\endcsname{jascriptscriptfont}}
\expandafter\gdef\csname[rikuri jamathfont]\endcsname#1{
\expandafter\edef\csname[rikuri jamathfont type]\endcsname{#1}
\expandafter\afterassignment\csname[rikuri jamathfont with type]\endcsname
\count0=
}
\expandafter\gdef\csname[rikuri jamathfont with type]\endcsname=#1{
\expandafter\edef\csname[rikuri lfont notcsname]\rikuriendcsname{
\ifx\csname#1\else\csname[rikuri notcsname]\expandafter\rikuriendcsname\string#1\fi
}
\let\endcsname\rikuriendcsname
\ltjsetparameter{\csname[rikuri jamathfont type]\endcsname={\the\count0,\csname[rikuri jfont \csname[rikuri lfont notcsname]\endcsname]\endcsname}
}
}

\gdef\fontsize#1{\lfontsize{#1}\Lfontsize{#1}}
\gdef\lfontsize#1{\csname [rikuri^fontsize]\endcsname={#1}\csname\the\csname [rikuri^font]\endcsname\endcsname}
\gdef\Lfontsize#1{\csname[rikuri^jfontsize]\endcsname={#1}\csname\the\csname[rikuri^jfont]\endcsname\endcsname}

\expandafter\gdef\csname[rikuri notcsname]\endcsname#1#2{#2}

\gdef\tinydimen{5pt}\gdef\tiny{at 5pt}
\gdef\scriptsizedimen{7pt}\gdef\scriptsize{at 7pt}
\gdef\footnotesizedimen{8pt}\gdef\footnotesize{at 8pt}
\gdef\smalldimen{9pt}\gdef\small{at 9pt}
\gdef\normalsizedimen{10pt}\gdef\normalsize{at 10pt}
\gdef\largedimen{12pt}\gdef\large{at 12pt}
\gdef\Largedimen{14.4pt}\gdef\Large{at 14.4pt}
\gdef\LARGEdimen{17.28pt}\gdef\LARGE{at 17.28pt}
\gdef\hugedimen{20.74pt}\gdef\huge{at 20.74pt}
\gdef\Hugedimen{24.88pt}\gdef\Huge{at 24.88pt}
\gdef\BACKGROUNDdimen{51.60pt}\gdef\BACKGROUND{at 51.60pt}

\expandafter\gdef\csname[rikuri check not digit]\endcsname#1#2{
% check if #1 is NOT digit
% if #1 is digit #2 will be defined to a empty macro
% if #1 is not digit #2 will be \relax
% NOTE #1 and #2 !MUST be wrapped by \csname\endcsname
\expandafter\let#2\relax
\expandafter\ifx#11\expandafter\def#2{}\else
\expandafter\ifx#12\expandafter\def#2{}\else
\expandafter\ifx#13\expandafter\def#2{}\else
\expandafter\ifx#14\expandafter\def#2{}\else
\expandafter\ifx#15\expandafter\def#2{}\else
\expandafter\ifx#16\expandafter\def#2{}\else
\expandafter\ifx#17\expandafter\def#2{}\else
\expandafter\ifx#18\expandafter\def#2{}\else
\expandafter\ifx#19\expandafter\def#2{}\else
\expandafter\ifx#10\expandafter\def#2{}\else
\fi\fi\fi\fi\fi\fi\fi\fi\fi\fi
}
\endgroup%
